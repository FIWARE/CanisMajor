<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://canismajor.readthedocs.io/Troubleshooting.html" />
      <link rel="shortcut icon" href="img/favicon.ico" />
    <title>Troubleshooting Guide: Canis Major Integration Tests - CanisMajor</title>
    <link rel="stylesheet" href="css/theme.css" />
    <link rel="stylesheet" href="css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="https://www.fiware.org/style/fiware_readthedocs.css" rel="stylesheet" />
        <link href="https://www.fiware.org/style/fiware_readthedocs_core.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Troubleshooting Guide: Canis Major Integration Tests";
        var mkdocs_page_input_path = "Troubleshooting.md";
        var mkdocs_page_url = "/Troubleshooting.html";
      </script>
    
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="index.html" class="icon icon-home"> CanisMajor
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="index.html">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="api.html">API</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CanisMajor</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Troubleshooting Guide: Canis Major Integration Tests</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/fiware/CanisMajor/docs/edit/master/docs/Troubleshooting.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="troubleshooting-guide-canis-major-integration-tests">Troubleshooting Guide: Canis Major Integration Tests</h1>
<h2 id="common-issue-build-failure-during-integration-tests">Common Issue: Build Failure During Integration Tests</h2>
<p>This guide addresses the most common issue encountered with the Canis Major adapter: build failure when running integration tests. If you experience a build failure while executing the <code>mvn clean test</code> command, follow these steps to resolve the issue.</p>
<h3 id="solution-updating-ngsi-address-environment-variable">Solution: Updating 'NGSI Address' environment variable</h3>
<ol>
<li><strong>Check the IP Address of the Canis Major Container</strong></li>
</ol>
<p>Run the following command to obtain the IP address of the Canis Major container:</p>
<p><code>bash
   docker inspect -f '{{range .NetworkSettings.Networks}} \
   {{.IPAddress}}{{end}}'&lt;canis_major_container_name_or_id&gt;</code></p>
<p>Replace <code>&lt;canis_major_container_name_or_id&gt;</code> with the actual name or ID of your Canis Major container.</p>
<ol>
<li><strong>Run Tests with Updated NGSI Address</strong></li>
</ol>
<p>Navigate to the <code>/it</code> folder and execute the following command:</p>
<p><code>bash
   cd it
   NGSI_ADDRESS=&lt;ip_address_of_canis_major_container&gt;:4000 mvn clean test</code></p>
<p>Replace <code>&lt;ip_address_of_canis_major_container&gt;</code> with the IP address obtained in step 1.</p>
<h3 id="command-breakdown">Command Breakdown</h3>
<p>The command used in step 2 consists of two main parts:</p>
<ol>
<li><strong>Environment Variable Assignment</strong>:
   <code>NGSI_ADDRESS=&lt;ip_address_of_canis_major_container&gt;:4000</code></li>
<li>Sets the <code>NGSI_ADDRESS</code> environment variable.</li>
<li>
<p>Specifies the address of the ETSI NGSI-LD API of the Canis Major.</p>
</li>
<li>
<p><strong>Maven Command</strong>:
   <code>mvn clean test</code></p>
</li>
<li><code>clean</code>: Deletes the <code>target</code> directory, ensuring a clean build environment.</li>
<li><code>test</code>: Compiles the source code and runs all unit tests in the project.</li>
</ol>
<p>By using this approach, you ensure that the integration tests are executed against the correct Canis Major endpoint, which should resolve the build failure issue.</p>
<p>If you continue to experience problems after following the provided steps, please open an issue in the GitHub repository with detailed information about the error you are encountering.</p>
<h2 id="common-issue-problem-to-execute-the-integration-test-again">Common Issue: Problem to execute the integration test again.</h2>
<p>If you try to execute twice the integration tests, you will receive an error message like the following:</p>
<pre><code class="language-bash">[INFO] -------------------------------------------------------
[INFO] T E S T S
[INFO] -------------------------------------------------------
[INFO] Running it.RunCucumberTest

Scenario: A test-store, created at orion-ld, is available through CanisMajor. 
 # it/store_transactions_on_entities_in_canis_major.feature:4
 Given CanisMajor is running and available for requests.
 # it.StepDefinitions.setup_canis_major_in_docker()
 And Vault is configured as a signing endpoint.
 # it.StepDefinitions.configure_ethereum_plugin_vault()
 And Franzi is registered in vault.
 # it.StepDefinitions.register_franzi_in_vault()
 And Mira is registered in vault.
 # it.StepDefinitions.register_mira_in_vault()
 When Franzi creates the test-store.
 # it.StepDefinitions.create_test_store()
 Then Only one transaction should be persisted for the entity.
 # it.StepDefinitions.assert_only_one_transaction()
org.awaitility.core.ConditionTimeoutException: Condition with it.StepDefinitions was not
 fulfilled within 15 seconds.
at org.awaitility.core.ConditionAwaiter.await(ConditionAwaiter.java:165)
at org.awaitility.core.CallableCondition.await(CallableCondition.java:78)
at org.awaitility.core.CallableCondition.await(CallableCondition.java:26)
at org.awaitility.core.ConditionFactory.until(ConditionFactory.java:895)
at org.awaitility.core.ConditionFactory.until(ConditionFactory.java:864)
at it.StepDefinitions.assert_only_one_transaction(StepDefinitions.java:559)
at âœ½.Only one transaction should be persisted for the entity.
(classpath:it/store_transactions_on_entities_in_canis_major.feature:10)
 And The transaction to persist test-store can be read through CanisMajor.
 # it.StepDefinitions.get_test_store()
</code></pre>
<p>This is produced by the intent to save again the information of the users' credentials in the Vault.</p>
<h3 id="solution-1-clean-the-docker-compose">Solution 1: Clean the docker compose</h3>
<blockquote>
<p>[!NOTE]
This is the preferred non-invasive solution</p>
</blockquote>
<p>For a docker compose clean, execute the following command:
   <code>shell
   sudo docker compose -f docker-compose-env.yaml -f docker-compose-java.yaml down -v</code>
This command deletes all containers, networks, and volumes created on the corresponding compose. It is the normal way to remove resources in a compose.</p>
<h3 id="solution-2-remove-all-running-containers-and-resources">Solution 2: Remove all running containers and resources</h3>
<blockquote>
<p>[!WARNING]
The following clean up will remove multiple containers <strong>including others not related to the deployment of Canis Major.</strong></p>
</blockquote>
<p>In the case that you are experiencing a conflict and you want to remove all the containers, volumes, and networks you have created in your machine,
follow these commands for a complete Docker cleanup of all resources.</p>
<ul>
<li>Stop all running containers</li>
</ul>
<pre><code class="language-shell">sudo docker stop $(sudo docker ps -aq)
</code></pre>
<ul>
<li>Remove all containers</li>
</ul>
<pre><code class="language-shell">sudo docker rm $(sudo docker ps -aq)
</code></pre>
<ul>
<li>Remove all volumes</li>
</ul>
<pre><code class="language-shell">sudo docker volume rm $(sudo docker volume ls -q)
</code></pre>
<ul>
<li>Remove all custom networks</li>
</ul>
<pre><code class="language-shell">sudo docker network prune
</code></pre>
<blockquote>
<p>[!TIP]
- You can add <code>-f</code> flag to skip confirmation prompts.
- Root privileges <code>sudo</code> may be required depending on your Docker setup.</p>
</blockquote>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/fiware/CanisMajor/docs" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
    
  </span>
</div>
    <script src="js/jquery-3.6.0.min.js"></script>
    <script>var base_url = ".";</script>
    <script src="js/theme_extra.js"></script>
    <script src="js/theme.js"></script>
      <script src="search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
